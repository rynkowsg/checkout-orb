description: >
  Clones Git repo.

# REMINDER: If you change anything here, copy-paste it to the test job.
parameters:
  debug:
    type: boolean
    default: false
    description: |
      When true, debug command logging is enabled
  depth:
    type: integer
    default: -1
    description: |
      Specifies the clone depth, indicating the number of recent commits to include.
      Default: -1 (fetches all commits).
  dest_dir:
    type: string
    default: ""
    description: |
      Destination directory for the repository.
      Defaults to DEST_DIR, then CIRCLE_WORKING_DIRECTORY, or current directory if unset.
  github_token:
    type: string
    default: ""
    description: |
      GitHub token. It can help to surpass connection quotas per machine.
  lfs:
    type: boolean
    default: false
    description:  |
      Enables cloning with Git Large File Storage (LFS) support.
  name_displayed:
    type: string
    default: "checkout-orb/checkout"
    description: |
      The display name for the command.
  repo_branch:
    type: string
    default: ""
    description: |
      Specifies the branch to checkout.
      Defaults to REPO_BRANCH, then CIRCLE_BRANCH if unset.
  repo_sha1:
    type: string
    default: ""
    description: |
      Specifies the commit SHA1 to checkout.
      Defaults to REPO_SHA1, then CIRCLE_SHA1 if unset.
  repo_tag:
    type: string
    default: ""
    description: |
      Specifies the tag to checkout.
      Defaults to REPO_TAG, then CIRCLE_TAG if unset.
  repo_url:
    type: string
    default: ""
    description: |
      Specifies the repository URL.
      Defaults to REPO_URL, then CIRCLE_REPOSITORY_URL if unset.
  submodules:
    type: boolean
    default: false
    description: |
      Enables cloning of submodules.
  submodules_depth:
    type: integer
    default: -1
    description: |
      Specifies the clone depth for submodules, indicating the number of recent commits to include.
      Default: -1 (fetches all commits).
    # It is worth to remember that GitHub doesn't allow to fetch by SHA1.
    # In such a case, with shallow clone, the required reference can't be found.
    # https://github.com/boostorg/boost/issues/245#issuecomment-470716527

steps:
  - run:
      # REMINDER: If you change anything here, copy-paste it to the test job.
      environment:
        PARAM_DEBUG: <<parameters.debug>>
        PARAM_DEPTH: <<parameters.depth>>
        PARAM_DEST_DIR: <<parameters.dest_dir>>
        PARAM_GITHUB_TOKEN: <<parameters.github_token>>
        PARAM_LFS_ENABLED: <<parameters.lfs>>
        PARAM_REPO_BRANCH: <<parameters.repo_branch>>
        PARAM_REPO_SHA1: <<parameters.repo_sha1>>
        PARAM_REPO_TAG: <<parameters.repo_tag>>
        PARAM_REPO_URL: <<parameters.repo_url>>
        PARAM_SUBMODULES_ENABLED: <<parameters.submodules>>
      name: <<parameters.name_displayed>>
      command: <<include(scripts/clone_git_repo.bash)>>
